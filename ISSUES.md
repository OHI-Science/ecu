---
title: "Issues MSE 2019"
author: "A M Sajo Castelli"
date: "31 August 2019"
output:
  html_document: default
  pdf_document: default
---

# Table of progress
goal|status|layer issues | action
----|------|-------------|---------
AO| <span style="color:green">**Ok**</span> | score chaged | Revise
BD| GL | Global data |
CP | GL | Global data |
CS| GL | Global data |
CW | <span style="color:green">**Ok**</span> | score changed | Revise
ECO | <span style="color:green">**Ok**</span> | score changed| Revise
FIS | GL | Global data| 
FP| GL | Global data |
HAB| GL | Global data |
ICO| GL | R Code problems|
LE | GL | Global data |
LIV| <span style="color:green">**Ok**</span>  |
LSP| GL | Global data |
MAR| GL | Global data |
NP| GL | Global data |
SP| GL | Global data |
SPP| <span style="color:green">**Ok**</span> |
TR| <span style="color:green">**Ok**</span> |  score changed | Revise 

# Updates 31 August 2019
  1. Incorrectly named layer `cw_nutrients_trend_mse2019.csv` renamed to `cw_nutrient_trend_mse2019.csv`
  2. Removed unknown file layer `region2019/layers/hab_softbottom_mse2019.csv`
  3. `LAYERS.CSV` was not fully updated, following entries where corrected
      `hab_coral_extent_mse2019.csv` and `element_wts_hab_pres_abs_mse2019.csv`

# Scores 31 August 2019
```
AO(layers = layers)
  region_id   score dimension goal
1         6 80.7150    status   AO
2         7 82.3390    status   AO
3         6  0.0298     trend   AO
4         7  0.0741     trend   AO
```
```
CW(layers)
  region_id goal dimension       score
1         6   CW    status 72.29151383
2         7   CW    status 79.40565609
3         6   CW     trend -0.09486703
4         7   CW     trend -0.25114921
```
```
ECO(layers)
  region_id goal dimension       score
1         6  ECO    status  97.3600000
2         7  ECO    status 100.0000000
3         6  ECO     trend   0.4523954
4         7  ECO     trend  -1.0000000
```
```
LIV(layers)
  region_id goal dimension      score
1         6  LIV    status 98.9924668
2         7  LIV    status 98.9924668
3         6  LIV     trend  0.9519295
4         7  LIV     trend  0.9342872
```
```
SPP(layers)
  region_id goal dimension        score
1         6  SPP    status 94.824902700
2         7  SPP    status 94.824902700
3         6  SPP     trend -0.004867257
4         7  SPP     trend -0.004867257
```
```
TR(layers)
  region_id goal dimension    score
1         6   TR    status 97.96545
2         7   TR    status 69.08675
3         6   TR     trend -0.02480
4         7   TR     trend -0.05590
```

# Updates from 20 July 2019 - NOTES

Most of the problems are solved by updating the mistical `scen_data_year.csv` sheet. In fact, almost all the NA rows
are generated by data provided in this sheet. Some common problems where

  1. Incorrectly reported available data
  2. layers generally have TWO groups where they report available scenario/data years, only the first group was updated.
  3. Some of the updates in group 1 has missaligned years. As the documente for alignments states:
      (see http://ohi-science.org/ohicore/reference/AlignDataYears.html)
      Data should be aligned per available year of closes match.
      
> AlignDataYears
> Source: R/AlignDataYears.R
> 
> Used in conf/functions.R to link the year data was collected to the 
> appropriate scenario year for a data layer. A dataframe is returned 
> with both the **data year and the corresponding scenario year**. 
> The scenario year is used to join data layers with different data 
> years for use in models.




# Capas verificadas

## AO [OK]
`AO` was verified and changes were made.

### Correcciones: Archivo `scenario_data_years.csv`
```
  1 layer_name,scenario_year,data_year
  2 ao_access,2015,2019
  3 ao_access,2016,2019
  4 ao_access,2017,2019
  5 ao_access,2018,2019
  6 ao_access,2019,2019
  7 ao_need,2010,2010
  8 ao_need,2011,2011
  9 ao_need,2012,2012
 10 ao_need,2013,2013
 11 ao_need,2014,2014
 12 ao_need,2015,2015
 13 ao_need,2016,2016
 14 ao_need,2017,2016
 15 ao_need,2018,2016 
...
714 ao_need,2019,2016
```
Notar que **AO_NEED** tiene entradas entre las líneas
7:15 y adicionalmente 714 donde se especifica el último año de dato disponible e.g. 2016.

### Scores
Dado los cambios, los scores se actualizaron a
```
> AO(layers)
  region_id   score dimension goal
1         6 49.2850    status   AO
2         7 47.6610    status   AO
3         6 -0.0452     trend   AO
4         7 -0.1065     trend   AO
```



## CW [OK]
`CW` was verified and changes were made. Scores do not change.

Removed empty and wrong named layer `cw_nutrients_trend_mse2019.csv`.

Table of scores
```
> CW(layers)
  region_id goal dimension     score
1         6   CW    status 72.291514
2         7   CW    status 79.405656
3         6   CW     trend -0.882890
4         7   CW     trend -1.622609
```
Working domain

  *  Status 0-100
  *  Trend -100 to +100

## ECO [NO-OK]

**PROBLEMA**

Los datos en el archivo `eco_trend_mse2019.csv` requieren revisión: hay datos fuera del 
fuera del rango [-1.0, +1.0]. Revisar `layers.csv` Renglón 50 `ECO,eco_trend`

### Correciones
Score is being estimated twice. This is because in `scenario_data_years.csv`
has mis-aligned years and duplicate of last scenario/data years. Currently it
looks like
```
685 eco_status,2013,2013
686 eco_status,2014,2014
687 eco_status,2015,2015
688 eco_status,2016,2016
689 eco_status,2017,2017
690 eco_status,2018,2017
691 eco_trend,2015,2017
692 eco_trend,2016,2017
693 eco_trend,2017,2017
694 eco_trend,2018,2017
...
765 eco_status,2019,2017
766 eco_trend,2019,2017
```
Note: last data year for `eco_status` is 2017 and not 2013.

Tabla temporal
```
  region_id goal dimension       score
1         6  ECO    status  97.3600000
2         7  ECO    status 100.0000000
3         6  ECO     trend   0.4523954
4         7  ECO     trend  -1.5032097   <------ ! ERROR not in [-1, +1]
```

Problem in data layer `liv_trend_mse2019.csv`
```
rgn_id,year,trend
6,2017,0.452395374
7,2017,-1.503209681                       <- OUT OF RANGE per layers.csv: -1 to +1
```

Working domain

  *  Status 0 to 100
  *  Trend -1 to +1

# LIV [OK]

Fixed and scores don't change.

Initial scores
```
  region_id goal dimension      score
1         6  LIV    status 98.9924668
2         7  LIV    status 98.9924668
3        NA  LIV    status         NA
4         6  LIV     trend  0.9519295
5         7  LIV     trend  0.9342872
6        NA  LIV     trend         NA
```

Working domain

  *  Status 0 to 100
  *  Trend -1 to +1

Final fixed scores
```
  region_id goal dimension      score
1         6  LIV    status 98.9924668
2         7  LIV    status 98.9924668
3         6  LIV     trend  0.9519295
4         7  LIV     trend  0.9342872
```

Updated `scenario_data_years.csv` `diff -u`
```diff
»  git diff scenario_data_years.csv
diff --git a/region2019/conf/scenario_data_years.csv b/region2019/conf/scenario_data_years.csv
index 27e4626..67367ff 100644
--- a/region2019/conf/scenario_data_years.csv
+++ b/region2019/conf/scenario_data_years.csv
@@ -676,12 +676,10 @@
 liv_status,2015,2015
 liv_status,2016,2016
 liv_status,2017,2017
 liv_status,2018,2018
-liv_status,2019,2018
 liv_trend,2015,2018
 liv_trend,2016,2018
 liv_trend,2017,2018
 liv_trend,2018,2018
-liv_trend,2019,2019
 eco_status,2013,2013
 eco_status,2014,2014
 eco_status,2015,2015
@@ -760,8 +758,8 @@
 tr_jobs_pct_tourism,2019,2017
 tr_sustainability,2019,2017
 tr_travelwarnings,2019,2018
 wgi_all,2019,2016
-liv_status,2019,2013
-liv_trend,2019,2013
+liv_status,2019,2018
+liv_trend,2019,2019
 eco_status,2019,2017
 eco_trend,2019,2017
 species_diversity_3nm,2019,2018
```
# SPP [OK]
This layer only does a simple linear transform on layer data.
```
  region_id goal dimension        score
1         6  SPP    status 94.824902700
2         7  SPP    status 94.824902700
3         6  SPP     trend -0.004867257
4         7  SPP     trend -0.004867257
```

Working domain

  *  Status 0 to 100
  *  Trend -1 to +1

Note: `scen_data_year.csv` does not report on available data from TREND component.
Assumes it matches with STATUS layer data (!).

# TR [NO-OK] SCORES CHANGED
Problem with data layer `tr_sustainability_mse2019.csv` variable `S_score` out of range (0 to 1)
```
rgn_id,year,S_score
6,2017,3.91
7,2017,3.91
```
Reading `TR` funtion, potential fix it to scale with respect to max TTCI index of 7.0, so new scores could be
3.91 / 7.0 for both regions.

Initial score table
```
> TR(layers)
  region_id goal dimension     score
1         6   TR    status 100.00000
2         7   TR    status  70.52154
3         6   TR     trend   0.21380
4         7   TR     trend   0.21380
```
Temporary updated scores **SCORES CHANGED** revision required
```
  region_id goal dimension    score
1         6   TR    status 97.96545
2         7   TR    status 69.08675
3         6   TR     trend -0.02480
4         7   TR     trend -0.05590
```
Additional fixes to `scenario_data_year.csv`
```
»  git diff ../conf/scenario_data_years.csv
diff --git a/region2019/conf/scenario_data_years.csv b/region2019/conf/scenario_data_years.csv
index 67367ff..74cb609 100644
--- a/region2019/conf/scenario_data_years.csv
+++ b/region2019/conf/scenario_data_years.csv
@@ -638,15 +638,15 @@ ss_wgi,2015,2013
 ss_wgi,2016,2014
 ss_wgi,2017,2015
 ss_wgi,2018,2016
-tr_jobs_pct_tourism,2010,2009
-tr_jobs_pct_tourism,2011,2010
-tr_jobs_pct_tourism,2012,2011
-tr_jobs_pct_tourism,2013,2012
-tr_jobs_pct_tourism,2014,2013
-tr_jobs_pct_tourism,2015,2014
-tr_jobs_pct_tourism,2016,2015
-tr_jobs_pct_tourism,2017,2016
-tr_jobs_pct_tourism,2018,2017
+tr_jobs_pct_tourism,2010,2010
+tr_jobs_pct_tourism,2011,2011
+tr_jobs_pct_tourism,2012,2012
+tr_jobs_pct_tourism,2013,2013
+tr_jobs_pct_tourism,2014,2014
+tr_jobs_pct_tourism,2015,2015
+tr_jobs_pct_tourism,2016,2016
+tr_jobs_pct_tourism,2017,2017
+tr_jobs_pct_tourism,2018,2018
 tr_sustainability,2010,2017
 tr_sustainability,2011,2017
 tr_sustainability,2012,2017
@@ -754,7 +754,7 @@ res_spi,2019,2018
 sp_genetic,2019,2016
 ss_spi,2019,2018
 ss_wgi,2019,2016
-tr_jobs_pct_tourism,2019,2017
+tr_jobs_pct_tourism,2019,2018^M
 tr_sustainability,2019,2017
 tr_travelwarnings,2019,2018
 wgi_all,2019,2016
```

Working domain

  *  Status 0-100
  *  Trend 0-1
  

# HAB [] GL2018
```
> HAB(layers)
# A tibble: 0 x 4
# … with 4 variables: region_id <int>, goal <chr>, dimension <chr>, score <dbl>
```


# Ignore rest of report

# [IGNORE this section] Issues and descriptions

  1. no layer of source file has reference to `un_regions` found in
     `ICO(layers)` a @ `functions.R`:1241
 
  2. need to update layers `layers/rgn_area.csv` and others
     see warning('AndresS: CSV layers/rgn_area.csv no tiene las superficies correctas en km**2') in `config.R`

  1. `cw_trash_trend` missing rgn_id
     `cw_pathogen_trend` missing rgn_id SCRIPT that check for the intersection of years in
     LAYER, scenario_data_year.csv, layers.cs


  *  `[D]`  LIV
  *  `[D]`  SPP
  *  `[ ]`  HAB
  *  `[ ]`  ICO Commented last part where unknown object are referenced.

# CheckLayers

Unused fields...
    ico_spp_iucn_status: iucn_sid,eval_yr
    mar_harvest_tonnes: taxa_group
    uninhabited: southern_island,est_population
    
Rows duplicated...
    ico_spp_iucn_status: 162
    
Layers missing data, ie all NA ...
    element_wts_cp_km2_x_protection: element_wts_cp_km2_x_protection_gl2018.csv
    element_wts_cs_km2_x_storage: element_wts_cs_km2_x_storage_gl2018.csv
    element_wts_hab_pres_abs: element_wts_hab_pres_abs_gl2018.csv
    
Layer element_wts_cp_km2_x_protection has no rows of data.
Layer element_wts_cs_km2_x_storage has no rows of data.
Layer element_wts_hab_pres_abs has no rows of data.

